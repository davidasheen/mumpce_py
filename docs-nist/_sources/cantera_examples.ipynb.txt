{
 "cells": [
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Examples input for the Cantera interface\n",
    "****************************************\n",
    "\n",
    "Imports\n",
    "=======\n",
    "\n",
    "Import the mumpce interface as well as the interface to Cantera. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "import mumpce_py as mumpce\n",
    "import mumpce_py.cantera_utils as mpct\n",
    "import numpy as np\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Creating the Measurements\n",
    "=========================\n",
    "\n",
    "Reading the experimental data file\n",
    "----------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "filename = 'Example_measurements.xlsx'\n",
    "df_dict = pd.read_excel(filename,sheetname=None)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "This creates a dictionary of Pandas DataFrame objects, keyed by the sheet name in Excel. We will use these to create the measurement lists.\n",
    "\n",
    "Initializing the experimental measurement list\n",
    "----------------------------------------------\n",
    "\n",
    "Use each DataFrame in the data dictionary to initialize a measurement list."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Ignition delay\n",
      "Flame speeds\n",
      "Single-pulse shock tube\n",
      "Reactions\n"
     ]
    }
   ],
   "source": [
    "measurements = dict()\n",
    "\n",
    "for key in df_dict:\n",
    "    print(key)\n",
    "    df = df_dict[key]\n",
    "    measurements[key] = mpct.measurement_initialize_pd(df)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {},
   "source": [
    "Including activation energies as active parameters\n",
    "--------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Single-pulse shock tube\n",
      "Reactions\n"
     ]
    }
   ],
   "source": [
    "keys_include_E = ['Single-pulse shock tube','Reactions']\n",
    "for key in keys_include_E:\n",
    "    print(key)\n",
    "    df = df_dict[key]\n",
    "    measurements[key] = mpct.measurement_initialize_pd(df,no_energy=False)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Creating the Projects\n",
    "=====================\n",
    "\n",
    "Projects from a single list\n",
    "---------------------------\n",
    "\n",
    "Each measurement list can be used to create an independent project."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "projects = dict()\n",
    "for key in df_dict:\n",
    "    projects[key] = mumpce.Project(measurement_list=measurements[key],name=key)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {
    "collapsed": false,
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Single-pulse shock tube\n",
      "15 measurements\n",
      "pro_Aa1 (Active): Specified mole frac:      850 K, 211.63 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C2H4 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pro_Aa2 (Active): Specified mole frac:      950 K, 295.51 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C2H4 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pro_Aa3 (Active): Specified mole frac:     1050 K, 363.41 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C2H4 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pro_Ab1 (Active): Specified mole frac:      850 K, 211.63 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C3H6 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pro_Ab2 (Active): Specified mole frac:      950 K, 295.51 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C3H6 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pro_Ab3 (Active): Specified mole frac:     1050 K, 363.41 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, mole fraction of C3H6 at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Ac1 (Active): Concentration ratio:      850 K, 211.63 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Ac2 (Active): Concentration ratio:      950 K, 295.51 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Ac3 (Active): Concentration ratio:     1050 K, 363.41 kPa, C4H10:0.010711755,C6H5CH3:0.040294685,tBPO:3.32e-05,O2:0,AR:0.94896036, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc1 (Active): Concentration ratio:      900 K, 137.66 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc2 (Active): Concentration ratio:      950 K, 157.68 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc3 (Active): Concentration ratio:     1000 K, 175.70 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc4 (Active): Concentration ratio:     1050 K, 192.00 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc5 (Active): Concentration ratio:     1100 K, 206.82 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc6 (Active): Concentration ratio:     1150 K, 220.34 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "\n"
     ]
    }
   ],
   "source": [
    "project = projects['Single-pulse shock tube']\n",
    "print(project)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Reactions\n",
      "9 measurements\n",
      "rxn_632_297 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      297 K, 303.98 kPa\n",
      "     K.R. Jennings, R.J. Cvetanovic, J. Chem. Phys. 35 (1961), 1233-1240.\n",
      "rxn_632_329 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      329 K, 303.98 kPa\n",
      "     K. Yang, J. Phys. Chem. 67 (1963), 562-566.\n",
      "rxn_632_513 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      513 K, 303.98 kPa\n",
      "     K. Yang, J. Phys. Chem. 67 (1963), 562-566.\n",
      "rxn_63r_318 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      318 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_325 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      325 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_350 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      350 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_375 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      375 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_400 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      400 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_413 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      413 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "\n"
     ]
    }
   ],
   "source": [
    "project = projects['Reactions']\n",
    "print(project)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Projects from a combined list\n",
    "-----------------------------\n",
    "\n",
    "Measurements from different lists can be split and combined to create a custom measurement list for a bigger project. In this case, we want to create a study of H-atom abstraction from butane by H atoms, a subset of the study by `Manion, Sheen, & Awan<http://dx.doi.org/10.1021/acs.jpca.5b01004>`_. We start by building the project's application list, which is going to be all of the single-pulse shock tube measurements where H-atom attack is the primary process. These measurements have names of the form 'pul_Cxx'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "applist = [item for item in measurements['Single-pulse shock tube'] if '_C' in item.name]"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Then we create the measurement list by using python's :py:func:`list.pop` method, which lets us pull the 0 and 4 elements from the applist. We create the measurement list as a new list with these items, and then attach the reaction rate measurements."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "mlist = [applist.pop(4),applist.pop(0)] + measurements['Reactions']"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Now with the measurement and application lists created, we initialize a new :py:class:`Project` with these lists. Notice that the application list has all of the 'pul_Cxx' except for those we added to the measurement list."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "H_abstraction_from_butane_by_H\n",
      "15 measurements\n",
      "pul_Cc5 (Active): Concentration ratio:     1100 K, 206.82 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc1 (Active): Concentration ratio:      900 K, 137.66 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "rxn_632_297 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      297 K, 303.98 kPa\n",
      "     K.R. Jennings, R.J. Cvetanovic, J. Chem. Phys. 35 (1961), 1233-1240.\n",
      "rxn_632_329 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      329 K, 303.98 kPa\n",
      "     K. Yang, J. Phys. Chem. 67 (1963), 562-566.\n",
      "rxn_632_513 (Active): Reaction C4H10 + H <=> H2 + pC4H9:      513 K, 303.98 kPa\n",
      "     K. Yang, J. Phys. Chem. 67 (1963), 562-566.\n",
      "rxn_63r_318 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      318 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_325 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      325 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_350 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      350 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_375 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      375 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_400 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      400 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "rxn_63r_413 (Active): Rate ratio k_[C4H10 + H <=> H2 + sC4H9]/k_[C4H10 + H <=> H2 + pC4H9]:      413 K, 303.98 kPa\n",
      "     J.M. Campbell, O.P. Strausz, H.E. Gunning, Can. J. Chem. 47 (1969), 3759-3762\n",
      "pul_Cc2 (Application): Concentration ratio:      950 K, 157.68 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc3 (Application): Concentration ratio:     1000 K, 175.70 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc4 (Application): Concentration ratio:     1050 K, 192.00 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "pul_Cc6 (Application): Concentration ratio:     1150 K, 220.34 kPa, C4H10:0.001020921,HME:5.73e-05,O2:0,AR:0.998921779, [C2H4]/[C3H6] at 0.5 ms\n",
      "     J. A. Manion, D. A. Sheen, I. A. Awan, J. Phys. Chem. A 119 (2015), 7637-7658.\n",
      "\n"
     ]
    }
   ],
   "source": [
    "project_Habs = mumpce.Project(measurement_list=mlist,application_list=applist,\n",
    "                              name='H_abstraction_from_butane_by_H')\n",
    "print(project_Habs)"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {},
   "source": [
    "project_Habs.find_sensitivity()"
   ]
  },
  {
   "cell_type": "raw",
   "metadata": {
    "raw_mimetype": "text/restructuredtext"
   },
   "source": [
    "Write out comma-separated versions of the DataFrames for use in other parts of the documentation."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Ignition delay.csv\n",
      "Flame speeds.csv\n",
      "Single-pulse shock tube.csv\n",
      "Reactions.csv\n"
     ]
    }
   ],
   "source": [
    "for key in df_dict:\n",
    "    csv_file = key + '.csv'\n",
    "    csv_example_file = key + ' example.csv'\n",
    "    print(csv_file)\n",
    "    df = df_dict[key].drop('Comment',axis=1)\n",
    "    df.to_csv(csv_file,index=False)\n",
    "    df[0:4].to_csv(csv_example_file,index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "celltoolbar": "Raw Cell Format",
  "kernelspec": {
   "display_name": "Python [conda env:py36]",
   "language": "python",
   "name": "conda-env-py36-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.0"
  },
  "widgets": {
   "state": {
    "466cd32399364474a584d5c7f39aad43": {
     "views": [
      {
       "cell_index": 15
      }
     ]
    },
    "64658427be2a40ddacb7aac2e76aa730": {
     "views": [
      {
       "cell_index": 15
      }
     ]
    }
   },
   "version": "1.2.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
